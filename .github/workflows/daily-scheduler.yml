name: Daily Schedule Generator

on:
  schedule:
    # Run once per day at 00:00 UTC to generate the day's schedule
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  generate-schedule:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout repo
        uses: actions/checkout@v4
        
      - name: 🎲 Generate daily schedule
        run: |
          # Generate random number between 1 and 30
          random_runs=$((RANDOM % 30 + 1))
          today=$(date -u +%Y-%m-%d)
          
          echo "🎯 Generated $random_runs runs for $today"
          
          # Calculate interval in minutes (1440 minutes in 24 hours)
          interval_minutes=$(echo "scale=2; 1440 / $random_runs" | bc -l)
          
          echo "⏰ Interval: $interval_minutes minutes between runs"
          
          # Generate evenly distributed times
          schedule_times=""
          for i in $(seq 0 $((random_runs - 1))); do
            # Calculate time for this run (in minutes from midnight)
            time_minutes=$(echo "scale=0; $i * $interval_minutes" | bc -l)
            
            # Convert to HH:MM format
            hours=$(($time_minutes / 60))
            minutes=$(($time_minutes % 60))
            
            # Format time
            time_formatted=$(printf "%02d:%02d" $hours $minutes)
            schedule_times="$schedule_times$time_formatted "
            
            echo "   Run $((i + 1)): $time_formatted UTC"
          done
          
          # Create schedule file
          schedule_file="schedule_${today}.txt"
          echo "DATE=$today" > $schedule_file
          echo "TOTAL_RUNS=$random_runs" >> $schedule_file
          echo "INTERVAL_MINUTES=$interval_minutes" >> $schedule_file
          echo "SCHEDULE_TIMES=$schedule_times" >> $schedule_file
          
          echo "📁 Created schedule file: $schedule_file"
          
      - name: 💾 Commit schedule
        run: |
          git config user.name "8ria"
          git config user.email "8ria@users.noreply.github.com"
          git add schedule_*.txt
          if git diff --cached --quiet; then
            echo "🟡 No schedule changes to commit."
          else
            git commit -m "📅 Generated daily schedule for $(date -u +%Y-%m-%d)"
            git push
            echo "✅ Schedule committed and pushed."
          fi
